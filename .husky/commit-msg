#!/usr/bin/env sh

msg=$(cat $1)
emojis='{"init":"ğŸ‰","feat":"âœ¨","package":"ğŸ“¦ï¸","config":"ğŸ”§","format":"ğŸ¨","style":"ğŸ’„","tests":"âœ…","docs":"ğŸ“","chore":"ğŸš§","fix":"ğŸ›","hotfix","ğŸš‘ï¸","performance":"âš¡ï¸","refactor":"â™»ï¸","revert":"âªï¸","merge":"ğŸ”€","deploy":"ğŸš€","release":"ğŸ”–"}'
msg_re="^(init|feat|package|config|format|style|tests|docs|chore|fix|hotfix|performance|refactor|revert|merge|deploy|release): .{1,100}"
emoji_re="^(ğŸ‰|âœ¨|ğŸ“¦ï¸|ğŸ”§|ğŸ¨|ğŸ’„|âœ…|ğŸ“|ğŸš§|ğŸ›|ğŸš‘ï¸|âš¡ï¸|â™»ï¸|âªï¸|ğŸ”€|ğŸš€|ğŸ”–) .{1,100}"

if [[ $msg =~ $msg_re ]] || [[ $msg =~ $emoji_re ]];then
  num=$(git status | grep -E 'modified|deleted|new file|renamed' | wc -l | awk '{print $1}')
  prefix=${msg%:*};
  submsg=${msg#*:};
  emoji=`echo $emojis |grep -Po ${prefix}'[": "]+\K[^"]+'`

  echo -e "debug commit message: [${msg}], [${emoji%,*}${submsg}]"
  if [ -z "$emoji" ];then
      commit_msg=${msg};
  else
      commit_msg=${emoji%,*}${submsg};
  fi
    echo "$commit_msg" > "$1"

else
    echo -e "Invalid 'commit' message format, eg: chore: <message> or ğŸš§ <message>
ğŸ’¡ commit prefixes: init|feat|package|config|format|style|tests|docs|chore|fix|hotfix|performance|refactor|revert|merge|deploy|release
ğŸ’¡ emoji  prefixes: ğŸ‰|âœ¨|ğŸ“¦ï¸|ğŸ”§|ğŸ¨|ğŸ’„|âœ…|ğŸ“|ğŸš§|ğŸ›|ğŸš‘ï¸|âš¡ï¸|â™»ï¸|âªï¸|ğŸ”€|ğŸš€|ğŸ”–" 
    exit 1
fi



